<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o - Controle de Produtividade</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e11d48; --clt: #0284c7; --pj: #7c3aed; --bg: #f8fafc; --nav: #1e293b; --border: #e2e8f0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-top: 85px; color: #1e293b; }

        /* NAVBAR PADRONIZADA */
        .navbar { position: fixed; top: 0; left: 0; right: 0; height: 75px; background: var(--nav); color: white; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .nav-left { display: flex; align-items: center; gap: 30px; }
        .brand { line-height: 1; cursor: pointer; }
        .brand .small { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: #94a3b8; display: block; margin-bottom: 2px; }
        .brand .big { font-size: 1.2rem; font-weight: 800; letter-spacing: -1px; color: white; }
        .brand .big span { color: var(--primary); }
        .nav-links { display: flex; gap: 20px; margin-left: 20px; }
        .nav-item { color: #94a3b8; text-decoration: none; font-size: 0.85rem; font-weight: 600; cursor: pointer; }
        .nav-item:hover, .nav-item.active { color: white; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        
        /* CARD ESTILIZADO */
        .card { background: white; border-radius: 15px; padding: 25px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .card-title { font-size: 1rem; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: var(--nav); border-bottom: 2px solid var(--bg); padding-bottom: 10px; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; font-size: 0.9rem; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
        .btn-danger:hover { background: #dc2626; color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.85rem; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid var(--bg); color: #64748b; }
        td { padding: 12px; border-bottom: 1px solid var(--bg); }

        .full-width { grid-column: span 2; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-left">
        <div class="brand" onclick="window.location.href='produtividade.html'">
            <span class="small">controle de</span>
            <div class="big">PRODUTIVIDADE<span>.</span></div>
        </div>
        <div class="nav-links">
            <a href="produtividade.html" class="nav-item">Dashboard</a>
            <a href="gestao.html" class="nav-item active">Gest√£o</a>
        </div>
    </div>
    <div style="text-align: right; color: white; font-size: 0.85rem; font-weight: 700;">
        Configura√ß√µes do Sistema
    </div>
</nav>

<div class="container">
    <div class="card">
        <div class="card-title">üë• Cadastro de Equipe</div>
        <div class="form-group">
            <label>ID da Assistente (Conforme Planilha)</label>
            <input type="number" id="u-id" placeholder="Ex: 123">
        </div>
        <div class="form-group">
            <label>Nome Completo</label>
            <input type="text" id="u-nome" placeholder="Nome da Assistente">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
                <label>Fun√ß√£o</label>
                <select id="u-fun">
                    <option value="Assistente">Assistente</option>
                    <option value="Auditora">Auditora</option>
                    <option value="Gestora">Gestora</option>
                </select>
            </div>
            <div class="form-group">
                <label>Tipo Contrato</label>
                <select id="u-con">
                    <option value="CLT">CLT</option>
                    <option value="PJ">PJ</option>
                </select>
            </div>
        </div>
        <button class="btn btn-primary" onclick="salvarUsuario()">Cadastrar / Atualizar</button>
    </div>

    <div class="card">
        <div class="card-title">üéØ Defini√ß√£o de Metas</div>
        <div class="form-group">
            <label>Selecionar Colaborador</label>
            <select id="m-user"></select>
        </div>
        <div class="form-group">
            <label>Valor da Meta Di√°ria</label>
            <input type="number" id="m-val" placeholder="Ex: 600">
        </div>
        <div class="form-group">
            <label>Vig√™ncia a partir de:</label>
            <input type="date" id="m-data">
        </div>
        <button class="btn btn-primary" onclick="salvarMeta()">Aplicar Nova Meta</button>
    </div>

    <div class="card full-width">
        <div class="card-title">üìã Colaboradores Ativos</div>
        <table id="lista-u">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Contrato</th>
                    <th>Fun√ß√£o</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="card full-width" style="border: 1px solid #fecaca; background: #fffafb;">
        <div class="card-title" style="color: #dc2626;">‚ö†Ô∏è Zona de Perigo</div>
        <p style="font-size: 0.85rem; color: #7f1d1d; margin-top: 0;">Use esta op√ß√£o apenas se desejar reiniciar o sistema. Isso apagar√° todas as produ√ß√µes importadas (planilhas), mas manter√° os nomes e metas dos funcion√°rios.</p>
        <button class="btn btn-danger" onclick="limparDadosProducao()">Limpar Todas as Importa√ß√µes</button>
    </div>
</div>

<script>
    const SB_URL = "https://glqrpsyjwozvislyxapj.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdscXJwc3lqd296dmlzbHl4YXBqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTQyOTgsImV4cCI6MjA4MTgzMDI5OH0.etzcmIHgPcGC12HwZPTU2u0DLtJdF3XTBSYW38O7S-w";
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    async function salvarUsuario() {
        const id = document.getElementById('u-id').value;
        const nome = document.getElementById('u-nome').value;
        const funcao = document.getElementById('u-fun').value;
        const contrato = document.getElementById('u-con').value;

        if(!id || !nome) return alert("Preencha ID e Nome!");

        const { error } = await _supabase.from('usuarios').upsert([{ 
            id: id, nome: nome, funcao: funcao, contrato: contrato, senha: '123' 
        }]);

        if(!error) { alert("Cadastro atualizado!"); carregarListas(); }
    }

    async function salvarMeta() {
        const uid = document.getElementById('m-user').value;
        const val = document.getElementById('m-val').value;
        const data = document.getElementById('m-data').value;

        if(!uid || !val || !data) return alert("Preencha todos os campos da meta!");

        const { error } = await _supabase.from('metas').insert([{
            usuario_id: uid, valor_meta: val, data_inicio: data
        }]);

        if(!error) { alert("Meta cadastrada!"); }
    }

    async function limparDadosProducao() {
        const confirmar = confirm("ATEN√á√ÉO: Isso apagar√° permanentemente todos os dados de planilhas importadas. Deseja continuar?");
        if(confirmar) {
            const senha = prompt("Digite a palavra 'LIMPAR' para confirmar:");
            if(senha === 'LIMPAR') {
                const { error } = await _supabase.from('producao').delete().neq('id', 0); // Deleta tudo
                if(!error) alert("Banco de dados de produ√ß√£o reiniciado com sucesso!");
                else alert("Erro ao limpar dados.");
            }
        }
    }

    async function carregarListas() {
        const { data: u } = await _supabase.from('usuarios').select('*').order('nome');
        
        // Popular Tabela
        const tbody = document.querySelector('#lista-u tbody');
        tbody.innerHTML = u.map(x => `
            <tr>
                <td>${x.id}</td>
                <td><b>${x.nome}</b></td>
                <td>${x.contrato}</td>
                <td>${x.funcao}</td>
            </tr>
        `).join('');

        // Popular Select de Metas
        const mSelect = document.getElementById('m-user');
        mSelect.innerHTML = u.filter(x => x.funcao === 'Assistente').map(x => `<option value="${x.id}">${x.nome}</option>`).join('');
    }

    carregarListas();
</script>
</body>
</html>

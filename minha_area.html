<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha √Årea</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="assets/css/style.css">
    
    <style>
        /* Apenas ajustes que s√≥ existem na Minha √Årea */
        .input-qty { width: 60px; text-align: center; font-weight: 600; }
        .input-feedback { border: 1px solid #fed7aa; background: #fff7ed; }
        /* Demais estilos gen√©ricos j√° est√£o no style.css */
    </style>
</head>
<body>

<div class="container">
    
    <div class="welcome-header">
        <div class="welcome-title">
            <h1 id="welcome-msg">Ol√°</h1>
            <p>Confer√™ncia de dados e metas.</p>
        </div>
    </div>

    <div class="top-controls">
        <div class="control-group hidden" id="manager-controls" style="flex: 2; border-right: 1px solid var(--border); padding-right: 15px;">
            <label style="color:var(--primary);">üëÅÔ∏è Visualizar Colaborador (Gest√£o)</label>
            <select id="user-selector" onchange="carregarMeusDados()"></select>
        </div>

        <div class="control-group">
            <label>Tipo de Per√≠odo</label>
            <select id="period-type" onchange="atualizarOpcoesPeriodo()">
                <option value="mes">Mensal</option>
                <option value="trimestre">Trimestral</option>
                <option value="semestre">Semestral</option>
                <option value="ano">Anual</option>
            </select>
        </div>
        <div class="control-group">
            <label>Ano</label>
            <select id="year-selector" onchange="atualizarOpcoesPeriodo()"></select>
        </div>
        <div class="control-group" style="flex: 1.5;">
            <label>Per√≠odo Espec√≠fico</label>
            <select id="period-value" onchange="carregarMeusDados()"></select>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card" style="border-top: 4px solid var(--primary);">
            <div class="stat-label">Total Sistema</div>
            <div class="stat-value" id="kpi-total">0</div>
        </div>
        <div class="stat-card" style="border-top: 4px solid var(--accent);">
            <div class="stat-label">Contagem Manual</div>
            <div class="stat-value" id="kpi-manual">0</div>
        </div>
        <div class="stat-card" style="border-top: 4px solid var(--success);">
            <div class="stat-label">Melhor Dia</div>
            <div class="stat-value" id="kpi-best">0</div>
            <div class="stat-sub" id="kpi-best-date">-</div>
        </div>
        <div class="stat-card" style="border-top: 4px solid var(--warning);">
            <div class="stat-label">Atingimento Meta</div>
            <div class="stat-value" id="kpi-hitrate">0%</div>
            <div class="stat-sub" id="kpi-meta-detail">-</div>
        </div>
    </div>

    <div class="chart-section">
        <div class="chart-title" id="chart-title-text">üìà Evolu√ß√£o</div>
        <div style="height: 250px; position: relative;">
            <canvas id="evolutionChart"></canvas>
        </div>
    </div>

    <div class="log-section">
        <div class="log-header">
            <h3>Di√°rio de Confer√™ncia</h3>
            <span style="font-size:0.75rem; color:var(--text-muted)">üîí = Travado ap√≥s resposta</span>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th style="text-align:center">Qtd. Sistema</th>
                    <th style="text-align:center">Minha Contagem</th>
                    <th style="text-align:center">Meta</th>
                    <th style="text-align:center">Status</th>
                    <th>Minhas Anota√ß√µes</th>
                    <th style="color:var(--primary)">Feedback Gest√£o</th>
                </tr>
            </thead>
            <tbody id="log-body"></tbody>
        </table>
    </div>
</div>

<script src="assets/js/config.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/layout.js"></script>

<script>
    // Aqui entra APENAS a l√≥gica espec√≠fica desta p√°gina (carregarMeusDados, renderizarLog, etc)
    // O c√≥digo JS grande que fizemos antes vai aqui, mas SEM as partes de login, logout e config que j√° importamos.
    
    // Vari√°veis Globais da P√°gina
    let myChart = null;
    let targetUserId = SESSAO_ATUAL.id; // Usa a vari√°vel global do auth.js
    const isGestora = SESSAO_ATUAL.funcao === 'Gestora';

    // Ao iniciar, atualiza o nome
    document.getElementById('welcome-msg').innerText = `Ol√°, ${SESSAO_ATUAL.nome.split(' ')[0]}`;

    async function init() {
        const yearSel = document.getElementById('year-selector');
        const currentYear = new Date().getFullYear();
        for(let y = currentYear; y >= 2024; y--) yearSel.innerHTML += `<option value="${y}">${y}</option>`;

        if (isGestora) {
            document.getElementById('manager-controls').classList.remove('hidden');
            document.getElementById('welcome-msg').innerText = `Painel da Gestora`;
            await loadUsers(); 
        } else {
            atualizarOpcoesPeriodo(); 
        }
    }

    // ... (COLE AQUI O RESTANTE DAS FUN√á√ïES: loadUsers, atualizarOpcoesPeriodo, carregarMeusDados, renderizarLog, etc) ...
    // ... (IMPORTANTE: N√£o copie a fun√ß√£o logout() nem as consts SB_URL, pois elas j√° v√™m dos arquivos importados) ...

    init();
</script>
</body>
</html>

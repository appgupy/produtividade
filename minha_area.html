<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Minha Área</title>
    <link rel="icon" href="assets/img/logo.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .input-qty { width: 60px; text-align: center; border: 1px solid #cbd5e1; border-radius: 4px; padding: 4px; }
        .input-qty:disabled { background: #e2e8f0; }
        .input-obs { width: 100%; border: 1px solid #e2e8f0; padding: 4px; border-radius: 4px; }
        .input-obs:disabled { background: #e2e8f0; }
        .input-feedback { border-color: #fed7aa; background: #fff7ed; }
        .input-divergent { border-color: red; color: red; background: #fee2e2; }
    </style>
</head>
<body>
<div class="container">
    <div class="welcome-header"><h1 id="welcome-msg">Olá</h1></div>
    <div class="top-controls">
        <div id="manager-controls" class="hidden" style="border-right:1px solid #ddd; padding-right:10px; margin-right:10px;"><select id="user-selector" onchange="carregar()"></select></div>
        <select id="period-type" onchange="updOpt()"><option value="mes">Mensal</option><option value="ano">Anual</option></select>
        <select id="year-selector" onchange="updOpt()"></select>
        <select id="period-value" onchange="carregar()"></select>
    </div>
    <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Sistema</div><div class="stat-value" id="kpi-sys">0</div></div>
        <div class="stat-card"><div class="stat-label">Manual</div><div class="stat-value" id="kpi-man">0</div></div>
        <div class="stat-card"><div class="stat-label">Meta</div><div class="stat-value" id="kpi-hit">0%</div></div>
    </div>
    <div class="chart-section" style="height:250px"><canvas id="chart"></canvas></div>
    <div class="log-section">
        <table><thead><tr><th>Data</th><th>Sis</th><th>Man</th><th>Meta</th><th>Minhas Notas</th><th>Feedback Gestão</th></tr></thead><tbody id="log-body"></tbody></table>
    </div>
</div>
<script src="assets/js/config.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/layout.js"></script>
<script>
    let uid = SESSAO_ATUAL.id; const isMgr = SESSAO_ATUAL.funcao==='Gestora'; let chart=null;
    document.addEventListener('DOMContentLoaded', init);
    async function init() {
        const y = document.getElementById('year-selector'); const cy = new Date().getFullYear();
        y.innerHTML=''; for(let i=cy; i>=2024; i--) y.innerHTML+=`<option value="${i}">${i}</option>`;
        if(isMgr) {
            document.getElementById('manager-controls').classList.remove('hidden');
            const {data} = await _supabase.from('usuarios').select('*').order('nome');
            const s = document.getElementById('user-selector');
            data.filter(u=>u.funcao!=='Gestora').forEach(u=>s.innerHTML+=`<option value="${u.id}">${u.nome}</option>`);
            if(data.length) uid = data[0].id;
        }
        updOpt();
    }
    function updOpt() {
        const t = document.getElementById('period-type').value; const s = document.getElementById('period-value'); s.innerHTML='';
        if(t==='mes') ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'].forEach((m,i)=>s.innerHTML+=`<option value="${i+1}" ${i===new Date().getMonth()?'selected':''}>${m}</option>`);
        else s.innerHTML='<option value="1">Ano Completo</option>';
        carregar();
    }
    async function carregar() {
        if(isMgr) uid = document.getElementById('user-selector').value;
        // ... (Lógica de datas igual aos outros arquivos) ...
        // ... (Busca dados do supabase e renderiza tabela) ...
        // Importante: A lógica de renderização deve verificar:
        // if (!isMgr && obs_gestora_tem_texto) -> disable input qtd e input obs assistente.
    }
    // ... (Copiar função atualizarDiario do código anterior com a lógica de permissão cruzada) ...
</script>
</body>
</html>
